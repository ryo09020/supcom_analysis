# 論文執筆支援レポジトリ

このプロジェクトは、補足コミュニケーションに関するデータ分析スクリプトを管理します。

## スクリプト一覧

### `z_standardize.py`

- **概要:** CSVファイル内の指定された列を標準化（zスコア化）します。
- **処理の流れ:**
    1.  `raw_data`ディレクトリから指定されたCSVファイルを読み込みます。
    2.  対象列の値をzスコアに変換します。
    3.  標準化の過程で欠損値を含む行は除外されます。
    4.  結果を`z_raw_data`ディレクトリに、元のファイル名で保存します。
- **入力:**
    -   ファイル: `raw_data/dummy_data.csv`
- **出力:**
    -   ファイル: `z_raw_data/dummy_data.csv`
- **ユーザー設定:**
    -   `input_dir`: 入力ディレクトリ名
    -   `input_filename`: 入力ファイル名
    -   `columns_to_standardize`: 標準化対象の列名リスト

### `decide_cluster.R`

- **概要:** 複数のクラスター数で潜在プロファイル分析（LPA）を一括実行し、最適なクラスター数を決定するための適合度指標を比較する表を作成します。
- **処理の流れ:**
    1.  入力CSVから分析対象の列を抽出し、zスコア化します（欠損値を持つ行は除外）。
    2.  指定された範囲のクラスター数（例: 2〜10）でLPAモデルをそれぞれ推定します。
    3.  各モデルの適合度指標とクラスごとの所属人数・割合を計算します。
    4.  結果を一つの比較表にまとめ、CSVファイルとして出力します。
- **入力:**
    -   ファイル: `dummy_data.csv`
    -   列: `542690_00`, `542700_00`, `542710_00`, `542720_00`, `542730_00`
- **出力:**
    -   ファイル: `lpa_comparison.csv`
- **ユーザー設定:**
    -   スクリプト内で入力ファイル名、分析対象列、クラスター数の範囲を直接指定する必要があります。

### `z_score.R`

- **概要:** 指定した単一のクラスター数でLPAを実行し、結果を可視化します。
- **処理の流れ:**
    1.  入力データをzスコア化した後、LPAを実行します。
    2.  各個人を最も所属確率の高いクラスターに割り当てます。
    3.  適合度指標とクラスターの所属人数をコンソールに出力します。
    4.  各クラスターの特性（項目ごとの平均zスコア）を棒グラフとレーダーチャートで描画します。
- **入力:**
    -   ファイル: `dummy_data.csv`
    -   列: `542690_00`, `542700_00`, `542710_00`, `542720_00`, `542730_00`
- **出力:**
    -   コンソール: 適合度指標、クラスターごとの所属人数・割合
    -   プロット: クラスター特性の棒グラフとレーダーチャート
- **ユーザー設定:**
    -   `CHOSEN_N_PROFILES`: 分析したいクラスター数を指定します。

### `assign_clusters.R`

- **概要:** LPAを実行し、元のデータに各個人の所属クラスター番号を付与した新しいCSVファイルを作成します。
- **処理の流れ:**
    1.  入力データをzスコア化します（欠損値を持つ行は除外）。
    2.  指定されたクラスター数でLPAを実行します。
    3.  元のデータに所属クラスター番号の列を追加し、CSVファイルとして出力します。
    4.  適合度指標、所属人数、および（存在すれば）クラスターごとの平均年齢などをコンソールに出力します。
- **入力:**
    -   ファイル: `input_file`変数で指定
- **出力:**
    -   ファイル: `(入力ファイル名)_with_clusters_sorted.csv`
    -   コンソール: 適合度指標、所属人数、平均年齢など
- **ユーザー設定:**
    -   `CHOSEN_N_PROFILES`: クラスター数
    -   `new_item_labels`: グラフの項目ラベル名
    -   `input_file`: 入力ファイルパス

### `heatmap_tipi_neo.R`

- **概要:** 2つの異なる尺度（例: TIPI-JとNEO-FFI）の項目間相関を計算し、ヒートマップとして可視化します。
- **処理の流れ:**
    1.  指定されたCSVファイルを読み込みます。
    2.  2つの尺度に対応する列をそれぞれ抽出します。
    3.  尺度間の相関行列を計算します（欠損値は行ごとに除外）。
    4.  相関行列をヒートマップで描画します。
- **入力:**
    -   ファイル: `file_path`変数で指定
- **出力:**
    -   プロット: 項目間相関のヒートマップ
- **ユーザー設定:**
    -   `file_path`: 入力ファイルパス
    -   `tipi_j_columns`: 尺度1の列名リスト
    -   `neo_ffi_columns`: 尺度2の列名リスト

---

### Mplus連携スクリプト (`mplus/`ディレクトリ)

#### `iterate_mplus.R`

- **概要:** Mplusを使用し、複数のクラスター数でLPAを自動実行します。
- **入力:**
    -   ファイル: `standardized_data_for_mplus.csv`
- **出力:**
    -   `tipi-j`ディレクトリ内に、クラスター数ごとのMplus関連ファイル（.inp, .out, .dat）
- **ユーザー設定:**
    -   Mplus実行ファイルのパス
    -   分析するクラスター数の範囲

#### `output_file_analysis.R`

- **概要:** `iterate_mplus.R`が生成したMplusのアウトプットファイルを読み込み、適合度指標のサマリー表を作成します。
- **入力:**
    -   `tipi-j`ディレクトリ内のMplusアウトプットファイル（.out）
- **出力:**
    -   ファイル: `LPA_summary_table.csv`
- **注意点:**
    -   実行前に`iterate_mplus.R`を実行し、`tipi-j`ディレクトリが作成されている必要があります。