
# supcom_analysis

This project analyzes supplementary communication data.

## Scripts

### `z_standardize.py`

*   **概要:** CSVファイル内の指定列を標準化（zスコア化）し、結果を別ディレクトリに元のファイル名で出力します。標準化対象外の列はそのまま維持されます。
*   **入力:**
    *   ファイル: `raw_data/dummy_data.csv` （ディレクトリとファイル名はスクリプト内で指定）
    *   フォーマット: CSV (ヘッダー付き)
*   **出力:**
    *   ファイル: `z_raw_data/dummy_data.csv` （`z_raw_data` ディレクトリ内に、入力と**同じファイル名**で保存）
    *   フォーマット: CSV
    *   内容: 指定列がzスコア化されたデータ。標準化の過程で欠損値を持つ行は削除されます。
*   **ユーザー設定:** スクリプト内の以下の変数を直接編集する必要があります。
    *   `input_dir`: 入力ファイルが格納されているディレクトリ名。
    *   `input_filename`: 入力ファイル名。
    *   `columns_to_standardize`: 標準化**対象**とする列名のリスト。


### `decide_cluster.R`

*   **概要:** 指定されたCSVファイルの特定項目をzスコア化した上で、複数のクラスター数（デフォルトは2〜10）で潜在プロファイル分析（LPA）を一括実行し、各モデルの適合度指標を比較するための表を作成します。
*   **分析の流れ:**
    1.  入力ファイル（`dummy_data.csv`）から分析対象の列を抽出します。
    2.  対象データをzスコア化（標準化）します。欠損値があるレコードは削除。
    3.  指定された範囲のクラスター数（例: 2から10）でLPAモデルをそれぞれ推定します。
    4.  各モデルの適合度指標（Log-likelihood, AIC, BIC, SABIC, Entropy, BLRT p-value）と、クラスごとの所属人数の割合を計算します。
    5.  結果を一つの比較表にまとめ、CSVファイルとして出力します。
*   **入力:**
    *   ファイル名: `dummy_data.csv`
    *   フォーマット: CSV
    *   ヘッダー: 必要
    *   列: `542690_00`, `542700_00`, `542710_00`, `542720_00`, `542730_00`
*   **出力:**
    *   ファイル名: `lpa_comparison.csv`
    *   フォーマット: CSV
    *   内容: クラスター数ごとの適合度指標と所属割合をまとめた比較表。
*   **制約:**
    *   分析対象の列名、入力ファイル名、クラスター数の範囲はスクリプト内で直接指定されています。

### `z_score.R`

*   **概要:** 入力データをzスコア化した後、指定された単一のクラスター数で潜在プロファイル分析（LPA）を実行し、結果を可視化します。
*   **分析手法のポイント:** `tidyLPA`パッケージによるLPAは、各個人が各クラスターに所属する確率（ソフトクラスタリング）を算出します。このスクリプトではその結果に基づき、各個人を**最も所属確率の高いクラスターに割り当て（ハードクラスタリング）**、その分類結果を用いて後続の分析・可視化を行います。これにより、LPAの推定結果と最終的なクラス分類の間に乖離が起きる懸念が解消されています。欠損地は削除されます、
*   **入力:**
    *   ファイル名: `dummy_data.csv`
    *   フォーマット: CSV
    *   ヘッダー: 必要
    *   列: `542690_00`, `542700_00`, `542710_00`, `542720_00`, `542730_00`
*   **出力:**
    *   コンソール出力: 指定クラスターモデルの適合度指標（AIC, BIC等）と、各クラスターの所属人数・割合。
    *   プロット: 各クラスターの特性（項目ごとの平均zスコア）を視覚化した棒グラフとレーダーチャート。
*   **制約:** 分析したいクラスター数は、スクリプト内の`CHOSEN_N_PROFILES`変数で直接指定する必要があります。

### `mplus/iterate_mplus.R`

*   **Overview:** This script automates the execution of LPA in Mplus for a range of cluster numbers.
*   **Input:**
    *   File name: `standardized_data_for_mplus.csv`
    *   Format: CSV
    *   Header: Not required
    *   Columns: `z_tipi_n`, `z_tipi_e`, `z_tipi_o`, `z_tipi_a`, `z_tipi_c`
*   **Output:**
    *   A directory named `tipi-j` containing Mplus input (.inp), output (.out), and data (.dat) files for each number of clusters.
*   **Constraints:** The path to the Mplus executable and the range of clusters must be specified within the script.

### `mplus/output_file_analysis.R`

*   **Overview:** This script reads the output files generated by `iterate_mplus.R` and creates a summary table of fit indices.
*   **Input:**
    *   A directory named `tipi-j` containing Mplus output files (.out).
*   **Output:**
    *   File name: `LPA_summary_table.csv`
    *   Format: CSV
    *   Content: A summary table of fit indices (LogLikelihood, AIC, BIC, aBIC, Entropy, VLMR_p_value, BLRT_p_value) and class percentages for each number of clusters.
*   **Constraints:** The `tipi-j` directory must exist and contain the Mplus output files.
